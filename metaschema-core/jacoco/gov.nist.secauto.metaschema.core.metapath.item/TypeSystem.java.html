<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TypeSystem.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Metaschema Core API</a> &gt; <a href="index.source.html" class="el_package">gov.nist.secauto.metaschema.core.metapath.item</a> &gt; <span class="el_source">TypeSystem.java</span></div><h1>TypeSystem.java</h1><pre class="source lang-java linenums">/*
 * SPDX-FileCopyrightText: none
 * SPDX-License-Identifier: CC0-1.0
 */

package gov.nist.secauto.metaschema.core.metapath.item;

import gov.nist.secauto.metaschema.core.datatype.IDataTypeAdapter;
import gov.nist.secauto.metaschema.core.datatype.adapter.MetaschemaDataTypeProvider;
import gov.nist.secauto.metaschema.core.metapath.MetapathConstants;
import gov.nist.secauto.metaschema.core.metapath.StaticContext;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IAnyAtomicItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IAnyUriItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IBase64BinaryItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IBooleanItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IDateItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IDateTimeItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IDayTimeDurationItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IDecimalItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IDurationItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IEmailAddressItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IHostnameItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IIPv4AddressItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IIPv6AddressItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IIntegerItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.INcNameItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.INonNegativeIntegerItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.INumericItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IPositiveIntegerItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IStringItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.ITokenItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IUriReferenceItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IUuidItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.IYearMonthDurationItem;
import gov.nist.secauto.metaschema.core.metapath.item.function.IArrayItem;
import gov.nist.secauto.metaschema.core.metapath.item.function.IMapItem;
import gov.nist.secauto.metaschema.core.metapath.item.node.IAssemblyNodeItem;
import gov.nist.secauto.metaschema.core.metapath.item.node.IDocumentNodeItem;
import gov.nist.secauto.metaschema.core.metapath.item.node.IFieldNodeItem;
import gov.nist.secauto.metaschema.core.metapath.item.node.IFlagNodeItem;
import gov.nist.secauto.metaschema.core.metapath.item.node.INodeItem;
import gov.nist.secauto.metaschema.core.util.ObjectUtils;

import java.util.Arrays;
import java.util.Collections;
import java.util.Map;
import java.util.stream.Stream;

import javax.xml.namespace.QName;

import edu.umd.cs.findbugs.annotations.NonNull;

@SuppressWarnings({ &quot;removal&quot;, &quot;deprecation&quot; })
public final class TypeSystem {
  private static final Map&lt;Class&lt;? extends IItem&gt;, QName&gt; ITEM_CLASS_TO_QNAME_MAP;

  static {
<span class="fc" id="L58">    ITEM_CLASS_TO_QNAME_MAP = Collections.unmodifiableMap(Map.ofEntries(</span>
<span class="fc" id="L59">        register(IItem.class, &quot;item&quot;),</span>
<span class="fc" id="L60">        register(INodeItem.class, &quot;node&quot;),</span>
<span class="fc" id="L61">        register(IDocumentNodeItem.class, &quot;document-node&quot;),</span>
<span class="fc" id="L62">        register(IAssemblyNodeItem.class, &quot;assembly-node&quot;),</span>
<span class="fc" id="L63">        register(IFieldNodeItem.class, &quot;field-node&quot;),</span>
<span class="fc" id="L64">        register(IFlagNodeItem.class, &quot;flag-node&quot;),</span>
<span class="fc" id="L65">        register(IArrayItem.class, &quot;array&quot;),</span>
<span class="fc" id="L66">        register(IMapItem.class, &quot;map&quot;),</span>
<span class="fc" id="L67">        register(IAnyAtomicItem.class, &quot;any-atomic-type&quot;),</span>
<span class="fc" id="L68">        register(INumericItem.class, &quot;numeric&quot;),</span>
<span class="fc" id="L69">        register(IDurationItem.class, &quot;duration&quot;),</span>
<span class="fc" id="L70">        register(IBase64BinaryItem.class, MetaschemaDataTypeProvider.BASE64),</span>
<span class="fc" id="L71">        register(IBooleanItem.class, MetaschemaDataTypeProvider.BOOLEAN),</span>
<span class="fc" id="L72">        register(IDateItem.class, MetaschemaDataTypeProvider.DATE),</span>
        // register(IDate.class, MetaschemaDataTypeProvider.DATE_WITH_TZ),
<span class="fc" id="L74">        register(IDateTimeItem.class, MetaschemaDataTypeProvider.DATE_TIME),</span>
        // register(IBooleanItem.class, MetaschemaDataTypeProvider.DATE_TIME_WITH_TZ),
<span class="fc" id="L76">        register(IIPv4AddressItem.class, MetaschemaDataTypeProvider.IP_V4_ADDRESS),</span>
<span class="fc" id="L77">        register(IIPv6AddressItem.class, MetaschemaDataTypeProvider.IP_V6_ADDRESS),</span>
<span class="fc" id="L78">        register(IAnyUriItem.class, MetaschemaDataTypeProvider.URI),</span>
<span class="fc" id="L79">        register(IUriReferenceItem.class, MetaschemaDataTypeProvider.URI_REFERENCE),</span>
<span class="fc" id="L80">        register(IUuidItem.class, MetaschemaDataTypeProvider.UUID),</span>
<span class="fc" id="L81">        register(IDayTimeDurationItem.class, MetaschemaDataTypeProvider.DAY_TIME_DURATION),</span>
<span class="fc" id="L82">        register(IYearMonthDurationItem.class, MetaschemaDataTypeProvider.YEAR_MONTH_DURATION),</span>
<span class="fc" id="L83">        register(IDecimalItem.class, MetaschemaDataTypeProvider.DECIMAL),</span>
<span class="fc" id="L84">        register(IIntegerItem.class, MetaschemaDataTypeProvider.INTEGER),</span>
<span class="fc" id="L85">        register(INonNegativeIntegerItem.class, MetaschemaDataTypeProvider.NON_NEGATIVE_INTEGER),</span>
<span class="fc" id="L86">        register(IPositiveIntegerItem.class, MetaschemaDataTypeProvider.POSITIVE_INTEGER),</span>
<span class="fc" id="L87">        register(IEmailAddressItem.class, MetaschemaDataTypeProvider.EMAIL_ADDRESS),</span>
<span class="fc" id="L88">        register(IHostnameItem.class, MetaschemaDataTypeProvider.HOSTNAME),</span>
<span class="fc" id="L89">        register(INcNameItem.class, MetaschemaDataTypeProvider.NCNAME),</span>
<span class="fc" id="L90">        register(IStringItem.class, MetaschemaDataTypeProvider.STRING),</span>
<span class="fc" id="L91">        register(ITokenItem.class, MetaschemaDataTypeProvider.TOKEN)));</span>
<span class="fc" id="L92">  }</span>

  private static Map.Entry&lt;Class&lt;? extends IItem&gt;, QName&gt; register(
      @NonNull Class&lt;? extends IItem&gt; clazz,
      @NonNull IDataTypeAdapter&lt;?&gt; adapter) {
<span class="fc" id="L97">    return Map.entry(clazz, adapter.getPreferredName());</span>
  }

  private static Map.Entry&lt;Class&lt;? extends IItem&gt;, QName&gt; register(
      @NonNull Class&lt;? extends IItem&gt; clazz,
      @NonNull String typeName) {
<span class="fc" id="L103">    return Map.entry(clazz, new QName(MetapathConstants.NS_METAPATH.toASCIIString(), typeName));</span>
  }

  @NonNull
  private static Stream&lt;Class&lt;? extends IItem&gt;&gt; getItemInterfaces(@NonNull Class&lt;?&gt; clazz) {
<span class="pc bpc" id="L108" title="1 of 2 branches missed.">    @SuppressWarnings(&quot;unchecked&quot;) Stream&lt;Class&lt;? extends IItem&gt;&gt; retval = IItem.class.isAssignableFrom(clazz)</span>
<span class="fc" id="L109">        ? Stream.of((Class&lt;? extends IItem&gt;) clazz)</span>
<span class="pc" id="L110">        : Stream.empty();</span>

<span class="fc" id="L112">    Class&lt;?&gt;[] interfaces = clazz.getInterfaces();</span>
<span class="pc bpc" id="L113" title="1 of 2 branches missed.">    if (interfaces.length &gt; 0) {</span>
<span class="fc" id="L114">      retval = Stream.concat(retval, Arrays.stream(interfaces).flatMap(TypeSystem::getItemInterfaces));</span>
    }

<span class="fc" id="L117">    return ObjectUtils.notNull(retval);</span>
  }

  /**
   * Get the human-friendly data type name for the provided Metapath item class.
   *
   * @param clazz
   *          the Metapath item class to get the name for
   * @return the name or {@code null} if no name is registered for the item class
   */
  public static String getName(@NonNull Class&lt;? extends IItem&gt; clazz) {
<span class="fc" id="L128">    Class&lt;? extends IItem&gt; itemClass = getItemInterfaces(clazz).findFirst().orElse(null);</span>

<span class="fc" id="L130">    QName qname = ITEM_CLASS_TO_QNAME_MAP.get(itemClass);</span>
<span class="pc bpc" id="L131" title="1 of 2 branches missed.">    return qname == null ? clazz.getName() : asPrefixedName(qname);</span>
  }

  private static String asPrefixedName(@NonNull QName qname) {
<span class="fc" id="L135">    String namespace = qname.getNamespaceURI();</span>
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">    String prefix = namespace.isEmpty() ? null : StaticContext.getWellKnownPrefixForUri(namespace);</span>
<span class="pc bpc" id="L137" title="1 of 2 branches missed.">    return prefix == null ? qname.toString() : prefix + &quot;:&quot; + qname.getLocalPart();</span>
  }

  private TypeSystem() {
    // disable construction
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>